<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Game of Life - WebSocket</title>

    <!-- SockJS -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>

    <!-- STOMP -->
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>

<h2>Game of Life</h2>

<label>Tamanho:</label>
<input type="number" id="size" value="20">

<label>Tempo (ms):</label>
<input type="number" id="time" value="500">

<button onclick="startGame()">Iniciar</button>

<pre id="board"></pre>

<script>

let stompClient = null;

function connect() {
    const socket = new SockJS('/ws');
    stompClient = Stomp.over(socket);

    stompClient.connect({}, function () {

        console.log("Conectado!");

        stompClient.subscribe('/topic/game', function (message) {

            const board = JSON.parse(message.body);
            renderBoard(board);

        });

    });
}

function startGame() {

    if (!stompClient) {
        connect();
        setTimeout(sendStart, 500);
    } else {
        sendStart();
    }
}

function sendStart() {

    const size = document.getElementById("size").value;
    const time = document.getElementById("time").value;

    stompClient.send("/app/start", {}, JSON.stringify({
        size: parseInt(size),
        time: parseInt(time)
    }));
}

function renderBoard(board) {

    let output = "";

    for (let i = 0; i < board.length; i++) {
        for (let j = 0; j < board.length; j++) {
            output += board[i][j] ? "⬛ " : "⬜ ";
        }
        output += "\n";
    }

    document.getElementById("board").textContent = output;
}

</script>

</body>
</html>